import{j as e,F as C,r as u,C as g,B as w,n as N}from"./index-CGeDB8zz.js";import{P as D}from"./PageBreadcrumb-Cnrp9Whe.js";import{C as E,u as $,o as O,c as R,b as T,a as M,d as v,e as A}from"./index.esm-uDgUuLMo.js";import{F as j}from"./FormTextInput-CNBC9OAQ.js";import{M as B,a as L,b as z,c as V}from"./Modal-TmluiE7L.js";import{R as k}from"./Row-CWRy5ILe.js";import{s as P}from"./SubscriptionService-uNt4E045.js";import{C as F,a as q}from"./Card-CSi_iu5Y.js";import"./PageMetaData-n-gIycqz.js";import"./useWillUnmount-rrcXYKfL.js";import"./TransitionWrapper-CQJwp69Z.js";import"./AbstractModalHeader-Bua5oTHf.js";import"./hasClass-CGfCoBh4.js";import"./divWithClassName-BuWCuVIH.js";import"./httpClient-C-6Fvtai.js";import"./CardHeaderContext-Cjczh1XH.js";const G=({control:o,id:l,label:x,name:h,containerClass:r,labelClassName:t,className:b,children:n,...c})=>e.jsx(E,{control:o,defaultValue:"",render:({field:m,fieldState:i})=>{var y,p;return c.multiple&&(m.value=[m.value]),e.jsxs(C.Group,{className:r,children:[x&&e.jsx(C.Label,{className:t,children:x}),e.jsx(C.Select,{id:l??h,className:b,isInvalid:i.error!=null,...m,...c,children:n}),((y=i.error)==null?void 0:y.message)&&e.jsx(C.Control.Feedback,{type:"invalid",className:"text-danger",children:(p=i.error)==null?void 0:p.message})]})},name:h}),H=[{code:"USD",name:"US Dollar",symbol:"$"},{code:"EUR",name:"Euro",symbol:"€"},{code:"GBP",name:"British Pound",symbol:"£"},{code:"INR",name:"Indian Rupee",symbol:"₹"},{code:"AUD",name:"Australian Dollar",symbol:"A$"},{code:"CAD",name:"Canadian Dollar",symbol:"C$"}],S="USD",K=R().shape({name:M().required("Please enter plan name"),price:v().required("Please enter price").min(0),currency:M().required("Currency is required"),description:M().required("Description required"),maxUsers:v().required("Max Users required").min(1),maxContacts:v().required("Max Contacts required").min(0),maxConversations:v().required("Max Conversations required").min(0),isTrialPlan:A().default(!1),sortOrder:v().required("Sort order required").min(0),moduleIds:T().of(M()).default([])}),Y=({show:o,onHide:l,onSubmit:x,modules:h,plan:r})=>{const{control:t,handleSubmit:b,reset:n,setValue:c,watch:m}=$({resolver:O(K),defaultValues:{name:"",price:0,currency:S,description:"",maxUsers:5,maxContacts:100,maxConversations:1e3,isTrialPlan:!1,sortOrder:0,moduleIds:[]}});u.useEffect(()=>{var a;o&&r?n({name:r.name,price:r.price,currency:r.currency||S,description:r.description,maxUsers:r.maxUsers,maxContacts:r.maxContacts,maxConversations:r.maxConversations,isTrialPlan:r.isTrialPlan||!1,sortOrder:r.sortOrder||0,moduleIds:((a=r.modules)==null?void 0:a.map(f=>f.id))||[]}):o&&!r&&n({name:"",price:0,currency:S,description:"",maxUsers:5,maxContacts:100,maxConversations:1e3,isTrialPlan:!1,sortOrder:0,moduleIds:[]})},[o,r,n]);const i=m("moduleIds")||[],y=a=>{const f=i.includes(a)?i.filter(s=>s!==a):[...i,a];c("moduleIds",f)},p=a=>{x(a),n(),l()};return e.jsxs(B,{show:o,onHide:l,size:"lg",centered:!0,scrollable:!0,className:"fade",children:[e.jsx(L,{className:"bg-primary",closeButton:!0,children:e.jsxs("h6",{className:"modal-title m-0 text-white",children:[e.jsx("i",{className:"mdi mdi-certificate-outline me-2"}),r?"Edit Subscription Plan":"Add Subscription Plan"]})}),e.jsx(z,{children:e.jsx(C,{onSubmit:b(p),children:e.jsxs(k,{children:[e.jsxs(g,{md:6,className:"pe-md-4 border-end",children:[e.jsx("h5",{className:"text-primary mb-4 fw-bold",children:"Plan Details"}),e.jsx(j,{name:"name",label:"Plan Name",placeholder:"e.g. Professional",containerClass:"mb-3",control:t}),e.jsxs(k,{children:[e.jsx(g,{md:4,children:e.jsx(j,{name:"price",label:"Monthly Price",placeholder:"0.00",type:"number",containerClass:"mb-3",control:t})}),e.jsx(g,{md:8,children:e.jsx(G,{name:"currency",label:"Currency",containerClass:"mb-3",control:t,children:H.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name," (",a.symbol,")"]},a.code))})})]}),e.jsx(j,{name:"description",label:"Description",placeholder:"Short summary of this plan",as:"textarea",containerClass:"mb-3",control:t}),e.jsxs("div",{className:"mb-3",children:[e.jsx(C.Check,{type:"checkbox",id:"isTrialPlan",label:"Is Trial Plan",...t.register("isTrialPlan")}),e.jsx("small",{className:"text-muted",children:"Only one trial plan is allowed in the system."})]}),e.jsx(j,{name:"sortOrder",label:"Sort Order (Hierarchy)",type:"number",placeholder:"0",containerClass:"mb-3",control:t}),e.jsx("h5",{className:"text-primary mt-4 mb-3 fw-bold",children:"Resource Limits"}),e.jsx(j,{name:"maxUsers",label:"Maximum Users",type:"number",containerClass:"mb-2",control:t}),e.jsx(j,{name:"maxContacts",label:"Maximum Contacts",type:"number",containerClass:"mb-2",control:t}),e.jsx(j,{name:"maxConversations",label:"Maximum Conversations",type:"number",containerClass:"mb-2",control:t})]}),e.jsxs(g,{md:6,className:"ps-md-4",children:[e.jsx("h5",{className:"text-primary mb-4 fw-bold",children:"Included Modules"}),e.jsxs("div",{className:"module-list",style:{maxHeight:"500px",overflowY:"auto"},children:[h.length===0&&e.jsx("p",{className:"text-muted italic",children:"No modules defined yet. Create modules first."}),h.map(a=>e.jsxs("div",{className:`d-flex align-items-center justify-content-between border rounded p-3 mb-2 cursor-pointer transition-all ${i.includes(a.id)?"border-primary bg-primary bg-opacity-10":"bg-light bg-opacity-25"}`,onClick:()=>y(a.id),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`rounded p-2 me-3 shadow-sm border ${i.includes(a.id)?"bg-primary text-white border-primary":"bg-white text-primary border-primary border-opacity-10"}`,children:e.jsx("i",{className:`mdi ${a.iconKeyword||"mdi-cube-outline"} fs-4`})}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-semibold text-dark d-block",children:a.name}),e.jsx("small",{className:"text-muted",children:a.description})]})]}),e.jsx("div",{className:"form-check",children:e.jsx("input",{className:"form-check-input",type:"checkbox",readOnly:!0,checked:i.includes(a.id)})})]},a.id))]})]})]})})}),e.jsxs(V,{children:[e.jsx(w,{variant:"de-secondary",size:"sm",onClick:l,children:"Cancel"}),e.jsxs(w,{variant:"de-primary",size:"sm",onClick:b(p),children:[e.jsx("i",{className:"mdi mdi-content-save me-1"}),"Save Plan"]})]})]})},oe=()=>{const[o,l]=u.useState(!1),[x,h]=u.useState([]),[r,t]=u.useState([]),[b,n]=u.useState(!1),[c,m]=u.useState(null),i=u.useCallback(async()=>{n(!0);try{const[s,d]=await Promise.all([P.getPlans(),P.getModules()]);h(s||[]),t(d||[])}catch{N.error("Failed to load subscription data")}finally{n(!1)}},[]);u.useEffect(()=>{i()},[i]);const y=async s=>{var I;const d={...s,modules:((I=s.moduleIds)==null?void 0:I.map(U=>({id:U})))||[]};try{c?(await P.updatePlan({...d,id:c.id}),N.success("Subscription plan updated successfully")):(await P.createPlan(d),N.success("Subscription plan created successfully")),f(),i()}catch{N.error(c?"Failed to update plan":"Failed to create plan")}},p=async s=>{if(window.confirm("Are you sure you want to delete this plan?"))try{await P.deletePlan(s),N.success("Plan deleted"),i()}catch{N.error("Failed to delete plan")}},a=s=>{m(s),l(!0)},f=()=>{m(null),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{subName:"Admin",title:"Manage Plan"}),e.jsx("div",{className:"text-end mb-3",children:e.jsxs(w,{variant:"de-primary",size:"sm",onClick:()=>l(!0),children:[e.jsx("i",{className:"mdi mdi-plus me-2"})," Create Plan"]})}),b?e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status"})}):e.jsxs(k,{children:[x.length===0&&e.jsx(g,{xs:12,children:e.jsx(F,{children:e.jsxs(q,{className:"text-center py-5",children:[e.jsx("i",{className:"mdi mdi-certificate-outline fs-1 text-muted"}),e.jsx("h5",{className:"mt-3",children:"No Plans Found"}),e.jsx("p",{className:"text-muted",children:"Create your first subscription plan to get started."})]})})}),x.map(s=>e.jsx(g,{lg:4,children:e.jsx(F,{className:"pricing-box",children:e.jsxs(q,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-uppercase m-0 d-inline-block me-2",children:s.name}),s.isTrialPlan&&e.jsx("span",{className:"badge bg-soft-success text-success",children:"Trial"}),e.jsxs("span",{className:"badge bg-soft-secondary text-secondary ms-1",children:["Order: ",s.sortOrder]})]}),e.jsx("div",{className:"dropdown",children:e.jsx(w,{variant:"link",className:"text-muted p-0 shadow-none",onClick:()=>p(s.id),children:e.jsx("i",{className:"mdi mdi-trash-can-outline fs-5 text-danger"})})})]}),e.jsx("div",{className:"pricing-value mb-4",children:e.jsxs("h2",{className:"mb-0",children:[e.jsx("span",{className:"font-14 text-muted fw-normal",children:s.currency||"$"}),s.price,e.jsx("span",{className:"font-14 text-muted fw-normal",children:"/mo"})]})}),e.jsx("p",{className:"text-muted limit-info mb-4",children:s.description}),e.jsxs("ul",{className:"list-unstyled pricing-features mb-3",children:[e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"mdi mdi-check-circle-outline text-success me-2"}),e.jsx("strong",{children:s.maxUsers})," Users"]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"mdi mdi-check-circle-outline text-success me-2"}),e.jsx("strong",{children:s.maxContacts})," Contacts"]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"mdi mdi-check-circle-outline text-success me-2"}),e.jsx("strong",{children:s.maxConversations})," Conversations"]})]}),s.modules&&s.modules.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-top my-3"}),e.jsx("h6",{className:"text-uppercase text-muted font-13 mb-3",children:"Included Modules"}),e.jsx("ul",{className:"list-unstyled pricing-features mb-4",children:s.modules.map(d=>e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:`mdi ${d.iconKeyword||"mdi-cube-outline"} text-primary me-2`}),d.name]},d.id))})]}),e.jsx(w,{variant:"outline-primary",className:"w-100",onClick:()=>a(s),children:"Edit Plan"})]})})},s.id))]}),e.jsx(Y,{show:o,onHide:f,onSubmit:y,modules:r,plan:c})]})};export{oe as default};
