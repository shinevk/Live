import{r,j as e,F as o,B as f,n as p,C,T as N}from"./index-UWoPjhNw.js";import{P as S}from"./PageBreadcrumb-IAcqlYv8.js";import{s as x}from"./SubscriptionService-uNt4E045.js";import{M as w,a as v,b as M,c as B}from"./Modal-CNsEysBJ.js";import{R as F}from"./Row-DRCOWo5M.js";import{C as T,a as H}from"./Card-DfaS8oCf.js";import{B as I}from"./Badge-BdIufG_Q.js";import"./PageMetaData-D6LBIgHc.js";import"./httpClient-C-6Fvtai.js";import"./useWillUnmount-D-AI_I_x.js";import"./TransitionWrapper-B1C7KRdj.js";import"./AbstractModalHeader-DNXpjiD2.js";import"./hasClass-vVUUF45E.js";import"./divWithClassName-CWTbDgrf.js";import"./CardHeaderContext-D7V0_4G1.js";const O=({show:d,onHide:i,organization:a,plans:m,onSubmit:u})=>{const[l,c]=r.useState("");r.useEffect(()=>{a&&c(a.subscriptionPlanId||"")},[a]);const n=()=>{l&&u(l)};return e.jsxs(w,{show:d,onHide:i,centered:!0,className:"fade",children:[e.jsx(v,{className:"bg-primary",closeButton:!0,children:e.jsxs("h6",{className:"modal-title m-0 text-white",children:[e.jsx("i",{className:"mdi mdi-swap-horizontal me-2"}),"Change Plan - ",a==null?void 0:a.name]})}),e.jsxs(M,{children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Select New Plan"}),e.jsxs(o.Select,{value:l,onChange:t=>c(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Plan --"}),m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.currency," ",t.price,"/mo)"]},t.id))]}),e.jsx(o.Text,{className:"text-muted",children:"Note: Upgrades are immediate. Downgrades will be scheduled after the current period."})]}),e.jsxs("div",{className:"alert alert-warning border-0",role:"alert",children:[e.jsx("i",{className:"mdi mdi-alert-outline me-2"}),"No refunds will be issued for downgrades. The current plan remains active until the end of the billing cycle."]})]}),e.jsxs(B,{children:[e.jsx(f,{variant:"de-secondary",size:"sm",onClick:i,children:"Cancel"}),e.jsx(f,{variant:"de-primary",size:"sm",onClick:n,disabled:!l||l===(a==null?void 0:a.subscriptionPlanId),children:"Update Plan"})]})]})},Y=()=>{const[d,i]=r.useState([]),[a,m]=r.useState([]),[u,l]=r.useState(!1),[c,n]=r.useState(!1),[t,g]=r.useState(null),h=r.useCallback(async()=>{l(!0);try{const[s,j]=await Promise.all([x.getOrganizations(),x.getPlans()]);i(s||[]),m(j||[])}catch(s){console.error("Failed to fetch data",s),p.error("Failed to load tenants data")}finally{l(!1)}},[]);r.useEffect(()=>{h()},[h]);const b=s=>{g(s),n(!0)},y=async s=>{if(t)try{await x.changePlan(t.id,s),p.success("Plan changed successfully"),n(!1),h()}catch{p.error("Failed to change plan")}},P=[{Header:"Organization Name",accessor:"name",Cell:({row:s})=>e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-soft-primary rounded-circle p-2 me-2 d-flex align-items-center justify-content-center",style:{width:"35px",height:"35px"},children:e.jsx("i",{className:"mdi mdi-office-building text-primary fs-5"})}),e.jsx("span",{className:"fw-bold",children:s.original.name})]})},{Header:"Country",accessor:"country"},{Header:"Current Plan",accessor:"subscriptionPlanName",Cell:({value:s})=>e.jsx(I,{bg:"info",className:"bg-opacity-10 text-info fw-bold px-2 py-1",children:s||"No Plan"})},{Header:"Action",accessor:"action",disableSortBy:!0,Cell:({row:s})=>e.jsxs(f,{variant:"outline-primary",size:"sm",onClick:()=>b(s.original),children:[e.jsx("i",{className:"mdi mdi-swap-horizontal me-1"})," Change Plan"]})}];return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:"Manage Tenants",subName:"Admin"}),e.jsx(F,{children:e.jsx(C,{xs:"12",children:e.jsx(T,{children:e.jsx(H,{children:e.jsx(N,{columns:P,data:d,pageSize:10,isSortable:!0,pagination:!0,isSearchable:!0,showToolbar:!0,isLoading:u})})})})}),e.jsx(O,{show:c,onHide:()=>n(!1),organization:t,plans:a,onSubmit:y})]})};export{Y as default};
