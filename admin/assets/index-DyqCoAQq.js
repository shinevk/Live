import{r as s,n as l,j as e,C as B,T as A,B as p}from"./index-CpZLcvae.js";import{P as k}from"./PageBreadcrumb-D1JCBMg4.js";import{H as j}from"./httpClient-C-6Fvtai.js";import{R as T}from"./Row-DIGZz7W5.js";import{C as F,a as M}from"./Card-UW7D9Rkj.js";import{M as o}from"./Modal-KFJt6VnV.js";import{B as n}from"./Badge-yskORo80.js";import"./PageMetaData-CEGm08XJ.js";import"./CardHeaderContext-CS5gnCY4.js";import"./divWithClassName-BhyBSul_.js";import"./useWillUnmount-UnJWc0c9.js";import"./TransitionWrapper-CboJNl0J.js";import"./AbstractModalHeader-DGIabsF-.js";import"./hasClass-CvMx389m.js";const R=async a=>(await j.get("/api/orders",{params:{organizationId:a}})).data,z=async a=>(await j.post(`/api/orders/${a}/approve`)).data,f={getOrders:R,approveOrder:z},Z=()=>{const[a,i]=s.useState([]),[C,m]=s.useState(!1),[b,v]=s.useState(0),[S,c]=s.useState(!1),[u,P]=s.useState(null),[g,h]=s.useState(!1),d=s.useCallback(async(r,x,D=1,I=10)=>{m(!0);try{const t=await f.getOrders(),y=t.records||t;i(y),v(t.totalRecords||y.length)}catch(t){console.error("Failed to fetch orders",t),l.error("Failed to fetch orders")}finally{m(!1)}},[]),O=r=>{P(r),c(!0)},w=async()=>{if(u){h(!0);try{await f.approveOrder(u),l.success("Order approved successfully"),d(),c(!1)}catch(r){console.error("Failed to approve order",r),l.error("Failed to approve order")}finally{h(!1)}}},H=r=>{switch(r){case"Paid":return e.jsx(n,{bg:"success",className:"bg-opacity-10 text-success px-2 py-1",children:"Paid"});case"PendingPayment":return e.jsx(n,{bg:"warning",className:"bg-opacity-10 text-warning px-2 py-1",children:"Pending Payment"});case"Cancelled":return e.jsx(n,{bg:"danger",className:"bg-opacity-10 text-danger px-2 py-1",children:"Cancelled"});default:return e.jsx(n,{bg:"secondary",className:"bg-opacity-10 text-secondary px-2 py-1",children:r})}},N=[{Header:"Order #",accessor:"orderNumber",Cell:({value:r})=>e.jsxs("span",{className:"fw-bold text-primary",children:["#",r]})},{Header:"Organization",accessor:"organizationName"},{Header:"Plan",accessor:"planName"},{Header:"Amount",accessor:"amount",Cell:({row:r})=>e.jsxs("span",{children:[r.original.currency," ",r.original.amount]})},{Header:"Date",accessor:"orderDate",Cell:({value:r})=>e.jsx("span",{children:new Date(r).toLocaleDateString()})},{Header:"Payment Method",accessor:"paymentMethod"},{Header:"Status",accessor:"status",Cell:({value:r})=>H(r)},{Header:"Action",accessor:"action",disableSortBy:!0,Cell:({row:r})=>e.jsx("div",{className:"d-flex gap-2",children:r.original.status==="PendingPayment"&&e.jsxs(p,{variant:"success",size:"sm",className:"bg-opacity-10 text-success border-success border-opacity-25",onClick:()=>O(r.original.id),children:[e.jsx("i",{className:"mdi mdi-check-circle me-1"})," Approve"]})})}];return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Manage Orders",subName:"Admin"}),e.jsx(T,{children:e.jsx(B,{xs:"12",children:e.jsx(F,{children:e.jsx(M,{children:e.jsx(A,{columns:N,data:a,pageSize:10,isSortable:!0,pagination:!0,isSearchable:!0,showToolbar:!0,isLoading:C,totalRecords:b,onPageChange:s.useCallback((r,x)=>{d(void 0,void 0,r,x)},[d])})})})})}),e.jsxs(o,{show:S,onHide:()=>c(!1),centered:!0,children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Approve Order"})}),e.jsx(o.Body,{children:"Are you sure you want to approve this order? This will mark it as processed in the system."}),e.jsxs(o.Footer,{children:[e.jsx(p,{variant:"light",onClick:()=>c(!1),children:"Cancel"}),e.jsx(p,{variant:"success",onClick:w,disabled:g,children:g?"Processing...":"Confirm Approve"})]})]})]})};export{Z as default};
