import{r as i,j as e,F as a,C as c,B as y,n as u,T as A}from"./index-CwmvLTAY.js";import{P as F}from"./PageBreadcrumb-C6Ll5pAH.js";import{a as h}from"./AIChatDataSourceService-Bz1LTWH6.js";import{M as f}from"./Modal-BRCer3fk.js";import{R as p}from"./Row-DQJWrMMf.js";import{C as G,a as L}from"./Card-nCwNBMnw.js";import{B as K}from"./Badge-oU2vCBLN.js";import"./PageMetaData-CgVBZ9tQ.js";import"./httpClient-C-6Fvtai.js";import"./useWillUnmount-CdxlDIlz.js";import"./TransitionWrapper-BaRKeh_t.js";import"./AbstractModalHeader-C78Th97u.js";import"./hasClass-BdzqvN6r.js";import"./CloseButton-G5q851n-.js";import"./Fade-Dpp_DACu.js";import"./divWithClassName-B6s3PHIC.js";import"./CardHeaderContext-B_VJR2Kl.js";const E=({show:b,onHide:C,dataSource:o,providers:w,onSubmit:I})=>{const[r,j]=i.useState({}),[x,d]=i.useState([]),[v,m]=i.useState(!1);i.useEffect(()=>{o?(j(o),o.aiDataSourceProviderId&&o.apiKey&&N(o.aiDataSourceProviderId,o.apiKey)):(j({name:"",aiDataSourceProviderId:"",apiKey:"",indexName:"",environment:"",modelName:"text-embedding-3-small",isConnected:!1,isWorkflowKnowledgeBase:!1}),d([]))},[o,b]);const N=async(n,t)=>{if(!(!n||!t)){m(!0);try{const s=await h.getIndexes(n,t);d(s||[])}catch(s){console.error("Failed to fetch indexes",s)}finally{m(!1)}}},l=n=>{const{name:t,value:s,type:g,checked:k}=n.target,P=g==="checkbox"?k:s;if(j(S=>({...S,[t]:P})),t==="apiKey"||t==="aiDataSourceProviderId"){const S=t==="aiDataSourceProviderId"?s:r.aiDataSourceProviderId,B=t==="apiKey"?s:r.apiKey;S&&B&&N(S,B)}},D=n=>{n.preventDefault(),I(r)};return e.jsxs(f,{show:b,onHide:C,size:"lg",centered:!0,children:[e.jsx(f.Header,{closeButton:!0,children:e.jsx(f.Title,{children:o?"Edit Connection":"Add Global Connection"})}),e.jsxs(a,{onSubmit:D,children:[e.jsxs(f.Body,{children:[e.jsxs(p,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Connection Name"}),e.jsx(a.Control,{type:"text",name:"name",value:r.name||"",onChange:l,placeholder:"e.g. Workflow Training DB",required:!0})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Provider"}),e.jsxs(a.Select,{name:"aiDataSourceProviderId",value:r.aiDataSourceProviderId||"",onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select Provider"}),w.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]})})]}),e.jsx(p,{children:e.jsx(c,{md:12,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"API Key"}),e.jsx(a.Control,{type:"password",name:"apiKey",value:r.apiKey||"",onChange:l,placeholder:"Enter your API Key",required:!0})]})})}),e.jsxs(p,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Index Name"}),e.jsxs(a.Select,{name:"indexName",value:r.indexName||"",onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select Index"}),x.map(n=>e.jsxs("option",{value:n.name,children:[n.name," (",n.dimension,"d)"]},n.name))]}),v&&e.jsx(a.Text,{className:"text-muted",children:"Loading indexes..."})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Embedding Model"}),e.jsx(a.Control,{type:"text",name:"modelName",value:r.modelName||"text-embedding-3-small",onChange:l,placeholder:"e.g. text-embedding-3-small"})]})})]}),e.jsxs(p,{children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Environment / Region"}),e.jsx(a.Control,{type:"text",name:"environment",value:r.environment||"",onChange:l,placeholder:"e.g. us-east-1"})]})}),e.jsx(c,{md:6,className:"d-flex align-items-center mt-3",children:e.jsx(a.Check,{type:"checkbox",label:"Use for Workflow Training (RAG)",name:"isWorkflowKnowledgeBase",checked:r.isWorkflowKnowledgeBase||!1,onChange:l,id:"isWorkflowKnowledgeBase"})})]})]}),e.jsxs(f.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:C,children:"Cancel"}),e.jsx(y,{variant:"primary",type:"submit",children:"Save Changes"})]})]})]})},ee=()=>{const[b,C]=i.useState([]),[o,w]=i.useState([]),[I,r]=i.useState(!1),[j,x]=i.useState(!1),[d,v]=i.useState(null),m=i.useCallback(async()=>{r(!0);try{const[s,g]=await Promise.all([h.getAll(),h.getProviders()]),k=(s||[]).filter(P=>!P.organizationId);C(k),w(g||[])}catch(s){console.error("Failed to fetch data",s),u.error("Failed to load global AI connections")}finally{r(!1)}},[]);i.useEffect(()=>{m()},[m]);const N=()=>{v(null),x(!0)},l=s=>{v(s),x(!0)},D=async s=>{if(window.confirm("Are you sure you want to delete this connection?"))try{await h.delete(s),u.success("Connection deleted successfully"),m()}catch{u.error("Failed to delete connection")}},n=async s=>{try{d!=null&&d.id?(await h.update(d.id,s),u.success("Connection updated successfully")):(await h.create({...s,organizationId:null}),u.success("Connection created successfully")),x(!1),m()}catch{u.error("Failed to save connection")}},t=[{Header:"Name",accessor:"name",Cell:({row:s})=>e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-soft-primary rounded-circle p-2 me-2 d-flex align-items-center justify-content-center",style:{width:"35px",height:"35px"},children:e.jsx("i",{className:"mdi mdi-robot text-primary fs-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold d-block",children:s.original.name}),s.original.isWorkflowKnowledgeBase&&e.jsxs(K,{bg:"success",className:"bg-opacity-10 text-success fw-normal mt-1",children:[e.jsx("i",{className:"mdi mdi-check-decagram me-1"})," Workflow Training Source"]})]})]})},{Header:"Model",accessor:"modelName"},{Header:"Index",accessor:"indexName"},{Header:"Status",accessor:"isConnected",Cell:({value:s})=>e.jsx(K,{bg:s?"success":"danger",className:`bg-opacity-10 text-${s?"success":"danger"} fw-bold px-2 py-1`,children:s?"Connected":"Disconnected"})},{Header:"Action",accessor:"action",disableSortBy:!0,Cell:({row:s})=>e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(y,{variant:"outline-primary",size:"sm",onClick:()=>l(s.original),children:e.jsx("i",{className:"mdi mdi-square-edit-outline"})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>D(s.original.id),children:e.jsx("i",{className:"mdi mdi-delete-outline"})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Global AI Connections",subName:"Admin"}),e.jsx(p,{className:"mb-3",children:e.jsx(c,{className:"text-end",children:e.jsxs(y,{variant:"primary",onClick:N,children:[e.jsx("i",{className:"mdi mdi-plus me-1"})," Add Connection"]})})}),e.jsx(p,{children:e.jsx(c,{xs:"12",children:e.jsx(G,{children:e.jsx(L,{children:e.jsx(A,{columns:t,data:b,pageSize:10,isSortable:!0,pagination:!0,isSearchable:!0,showToolbar:!0,isLoading:I})})})})}),e.jsx(E,{show:j,onHide:()=>x(!1),dataSource:d,providers:o,onSubmit:n})]})};export{ee as default};
